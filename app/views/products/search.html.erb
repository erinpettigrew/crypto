<div class="index-panel">
  <h1><%= @query %></h1>
</div>

<div class="add-product">
  <%= link_to "Add Product", new_product_path, class: "btn btn-primary btn-lg" %>
</div>

<div class="product-list">
  <div class="title">
    <%= pluralize(@products.count, "Product") %>
  </div>

  <div class="category-show">
    <% @products.each_with_index do |product, i| %>

    <div class="row product-row">
      <div class="col-xs-3 col-sm-3 col-md-3 product-image">
        <%= link_to image_tag(product.image.url), product %>
      </div>

      <div class="col-xs-5 col-sm-5 col-md-5">
        <div class="col-xs-12 col-sm-12 col-md-12 product-brand">
          <%= product.product_brand %>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 product-name">
          <%= link_to product.product_name, product %>
        </div>
      </div>

      <div class="col-xs-4 col-sm-4 col-md-4 review-info">
        <% if product.reviews.count >= 1 %>
        <div class="col-xs-12 col-sm-12 col-md-12">
          <div class="star-rating-index"><div class="star-rating" data-score= <%= product.average_rating %>></div></div>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-12">
          <%= link_to pluralize(product.reviews.count, "review"), product %><% unless product.uses.count.size == 0 %>, <%= pluralize(product.uses.count, "user") %><% end %>
        </div>
        <% elsif product.reviews.count == 0 %>
        <div class="col-xs-12">
          <!--<%= link_to "Add a review!", product %></br>-->
          <% unless product.uses.count == 0 %>
          <%= pluralize(product.uses.count, "user") %>
          <% end %>
        </div>
        <% end %>

        <% if product.uses.count > 0 %>
        <div class="uses">
          <div class="tiny-avatar">
            <%= image_tag(product.uses.first.try(:user).try(:avatar).try(:image).try(:small_thumb)) %>
            <%= image_tag(product.uses.second.try(:user).try(:avatar).try(:image).try(:small_thumb)) %>
            <%= image_tag(product.uses.third.try(:user).try(:avatar).try(:image).try(:small_thumb)) %>
          </div>
        </div>
        <% end %>


      </div>
    </div>
    <% end %>
  </div>
</div>



<script>
$('.star-rating').raty({
  path: 'https://s3.amazonaws.com/productbase/stars',
  readOnly: true,
  score: function() {
    return $(this).attr('data-score');
  }
});
</script>

<script>
mixpanel.track("Viewed Search Results", {"Search Term": "<%= @query %>"});
</script>
